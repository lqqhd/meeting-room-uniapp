{"version":3,"sources":["uni-app:///main.js","webpack:///D:/git-projects/daguanjia/daguanjia-uniapp/daguanjia-uniapp/pages/settings/header.vue?2c36","webpack:///D:/git-projects/daguanjia/daguanjia-uniapp/daguanjia-uniapp/pages/settings/header.vue?ad9d","webpack:///D:/git-projects/daguanjia/daguanjia-uniapp/daguanjia-uniapp/pages/settings/header.vue?6467","webpack:///D:/git-projects/daguanjia/daguanjia-uniapp/daguanjia-uniapp/pages/settings/header.vue?f252","uni-app:///pages/settings/header.vue"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,kG;AACAA,UAAU,CAACC,eAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAmH;AACnH;AAC0D;AACL;AACsC;;;AAG3F;AAC+K;AAC/K,gBAAgB,mLAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,iFAAM;AACR,EAAE,0FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,qFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AAA+pB,CAAgB,8oBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACgCnrB;AACA;AACA;AACA,wD;;AAEA;AACA,MADA,kBACA;AACA;;AAEA,wBAFA;AAGA,wBAHA;AAIA,qBAJA;AAKA,mBALA;AAMA,iBANA;;;AASA,GAXA;;AAaA,QAbA,oBAaA;AACA;AACA;AACA,GAhBA;;AAkBA,YAlBA;AAmBA,gBAnBA;AAoBA,WApBA;AAqBA;AACA,gBADA,0BACA;AACA;AACA,KAHA;;AAKA,mBALA,2BAKA,CALA,EAKA;AACA;AACA;AACA;AACA,KATA;;AAWA,mBAXA,2BAWA,QAXA,EAWA;AACA;AACA;AACA,KAdA;;AAgBA,aAhBA,qBAgBA,GAhBA,EAgBA;AACA;AACA,kCADA,GADA;;AAIA;AACA,kCALA;AAMA,KAtBA;;AAwBA,cAxBA,sBAwBA,GAxBA,EAwBA;AACA,6DADA;AAEA;AACA,kCADA,GAFA,SAEA,IAFA;;;AAMA;AACA;AACA;AACA;;AAEA;AACA,iBANA,MAMA;AACA;AACA,iBAdA;AAeA,KAvCA;;AAyCA,aAzCA,qBAyCA,GAzCA,EAyCA;AACA;AACA,KA3CA;;AA6CA,cA7CA,wBA6CA;AACA,0CADA;AAEA,8DAFA,SAEA,IAFA;AAGA;AACA;AACA;AACA,kCADA;AAEA,oCAFA;;AAIA;AACA,iBAPA,EAHA;AAWA,KAxDA;;AA0DA,aA1DA,uBA0DA;AACA,6DADA,SACA,IADA;AAEA,+CAFA;AAGA,KA7DA;;AA+DA,oBA/DA,8BA+DA;AACA,oBADA,GACA,uCADA;;AAGA,mCAHA;AAIA,0EAJA;;;;AAQA;AACA,4BADA;AAEA,4CAFA;AAGA,mDAHA,GARA,SAQA,WARA;;;AAcA,iDAdA;AAeA;AACA,sCADA;AAEA,8BAFA;AAGA,6BAHA;AAIA,gCAJA,IAfA;;AAqBA,qBArBA;;;AAwBA,sDAxBA;AAyBA;AACA,6CADA;AAEA,8BAFA;AAGA,6BAHA;AAIA,gCAJA,IAzBA;;AA+BA,qBA/BA;;;AAkCA;AACA,2CADA,GAlCA,UAkCA,IAlCA;;AAqCA,sBArCA,GAqCA,qBArCA;;AAuCA;AACA;AACA,iBAFA,MAEA;AACA;AACA;AACA,iBA5CA;AA6CA,KA5GA,EArBA;;;AAoIA;AACA,WADA,qBACA;AACA;AACA,KAHA,EApIA;;;AA0IA,WA1IA,E","file":"pages/settings/header.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/settings/header.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./header.vue?vue&type=template&id=d89ba3e0&\"\nvar renderjs\nimport script from \"./header.vue?vue&type=script&lang=js&\"\nexport * from \"./header.vue?vue&type=script&lang=js&\"\nimport style0 from \"@/static/styles/settings/header.scss?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/settings/header.vue\"\nexport default component.exports","export * from \"-!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./header.vue?vue&type=template&id=d89ba3e0&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      \"setBanner(\" + _vm.$1 + \")\"\n    }\n\n    _vm.e1 = function($event) {\n      $event.stopPropagation()\n      \"deleteItem(\" + _vm.$1 + \")\"\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./header.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./header.vue?vue&type=script&lang=js&\"","<template>\n\n  <view class=\"container\">\n    <view class=\"pannel-header\" :style=\"'display:' + (userRole > 2?'none':'flex')\">\n      <view class=\"pannel-title\">\n        <view class=\"title\">当前组织封面</view>\n        <view class=\"sub-title\"> ( 封面会应用到本组织所有成员 ) </view>\n      </view>\n      <view class=\"right-title\" @tap=\"set()\"></view>\n    </view>\n    <view class=\"header\">\n      <image class=\"bg\" :src=\"bannerUrl\"></image>\n    </view>\n    <view class=\"select-section\">\n      <i-panel title=\"封面图片\">\n        <view class=\"cover-setting\">\n          <view class=\"item\" v-for=\"(item, index) in banners\" :key=\"index\" @tap=\"'setBanner(' + $1 + ')'\">\n            <image :src=\"item.url\"></image>\n            <view v-if=\" item.system == 0 \" @tap.stop=\"'deleteItem(' + $1 + ')'\" class=\"close-item\">x</view>\n          </view>\n          <view class=\"item upload\" @tap=\"uploadUserBanner\">\n            <image src=\"../../static/images/upload.png\"></image>\n          </view>\n        </view>\n      </i-panel>\n      <i-action-sheet :visible=\"dataVisible\" :actions=\"actions\" show-cancel @cancel=\"handleCancel\" @click=\"handleClickItem\"></i-action-sheet>\n    </view>\n  </view>\n\n</template>\n\n<script>\nimport wxRequest from '@/utils/wxRequest';\nimport tip from '@/utils/tip';\nimport Session from '@/utils/session';\nimport { host } from '@/utils/host';\n\nexport default {\n  data() {\n    return {\n\n        dataVisible: false,\n        currentPosition: 1,\n        actionsList: [],\n        bannerUrl: '',\n        banners: []\n\n    };\n  },\n\n  onShow() {\n    this.getBanner();\n    this.getBanners();\n  },\n\n  mixins: [],\n  components: {},\n  props: {},\n  methods: {\n    handleCancel() {\n      this.dataVisible = false;\n    },\n\n    handleClickItem(e) {\n      const action = this.actionsList[this.currentPosition][e.detail.index];\n      this.updatePosition(action.value, this.currentPosition);\n      this.dataVisible = false;\n    },\n\n    showActionSheet(position) {\n      this.currentPosition = position;\n      this.dataVisible = true;\n    },\n\n    async setBanner(val) {\n      await wxRequest.Get('setting/setBanner', {\n        bannerUrl: val\n      });\n      Session.set('refresh', true);\n      this.getBanner();\n    },\n\n    async deleteItem(val) {\n      await tip.confirm('确认删除此封面吗！', {}, '提示');\n      const data = await wxRequest.Get('setting/delBanner', {\n        bannerUrl: val\n      });\n\n      if (data != undefined && data.code >= 1) {\n        if (data.message != undefined && data.message != '') {\n          tip.error(data.message);\n        }\n\n        this.getBanners();\n      } else {\n        tip.error(data.message);\n      }\n    },\n\n    isDefault(val) {\n      let aa = val;\n    },\n\n    async getBanners() {\n      this.banners.length = 0;\n      const data = await wxRequest.Get('setting/getBanners');\n      data.result.forEach(element => {\n        let system = element.indexOf('banner/1/') !== -1 ? 1 : 0;\n        let banner = {\n          \"url\": element,\n          \"system\": system\n        };\n        this.banners.push(banner);\n      });\n    },\n\n    async getBanner() {\n      const data = await wxRequest.Get('setting/getBanner');\n      this.bannerUrl = data.result;\n    },\n\n    async uploadUserBanner() {\n      let user = Session.get('user_load_cache');\n\n      if (user.companyId == 1) {\n        await tip.confirm('请创建组织后，再进行上传操作！', {}, '提示', false);\n        return;\n      }\n\n      const choseImages = await uni.chooseImage({\n        count: 1,\n        sizeType: ['compressed'],\n        sourceType: ['album', 'camera']\n      });\n\n      if (choseImages.tempFiles.length == 0) {\n        wx.showToast({\n          title: '上传失败， 请稍后再试',\n          icon: 'none',\n          mask: false,\n          duration: 1000\n        });\n        return false;\n      }\n\n      if (choseImages.tempFiles[0].size > 500000) {\n        wx.showToast({\n          title: '上传失败， 文件大小不能大于500K',\n          icon: 'none',\n          mask: false,\n          duration: 3000\n        });\n        return false;\n      }\n\n      let data = await wxRequest.Upload('setting/uploadBannerImg', choseImages.tempFiles[0].path, {\n        type: 'index_header_bg'\n      });\n      let result = JSON.parse(data.data);\n\n      if (result != undefined && result.code >= 1) {\n        this.getBanners();\n      } else {\n        tip.error(result.message);\n        console.log(result.message);\n      }\n    }\n\n  },\n  computed: {\n    actions() {\n      return this.actionsList[this.currentPosition];\n    }\n\n  },\n  watch: {}\n};\n</script>\n<style lang=\"scss\" src=\"@/static/styles/settings/header.scss\">\n\n\n\n</style>"],"sourceRoot":""}