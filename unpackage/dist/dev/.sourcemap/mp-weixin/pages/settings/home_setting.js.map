{"version":3,"sources":["uni-app:///main.js","webpack:///D:/git-projects/daguanjia/daguanjia-uniapp/daguanjia-uniapp/pages/settings/home_setting.vue?3c53","webpack:///D:/git-projects/daguanjia/daguanjia-uniapp/daguanjia-uniapp/pages/settings/home_setting.vue?4a99","webpack:///D:/git-projects/daguanjia/daguanjia-uniapp/daguanjia-uniapp/pages/settings/home_setting.vue?add7","webpack:///D:/git-projects/daguanjia/daguanjia-uniapp/daguanjia-uniapp/pages/settings/home_setting.vue?17ee","uni-app:///pages/settings/home_setting.vue"],"names":["createPage","Page"],"mappings":"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","file":"pages/settings/home_setting.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/settings/home_setting.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./home_setting.vue?vue&type=template&id=21de40b3&\"\nvar renderjs\nimport script from \"./home_setting.vue?vue&type=script&lang=js&\"\nexport * from \"./home_setting.vue?vue&type=script&lang=js&\"\nimport style0 from \"@/static/styles/setting.scss?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/settings/home_setting.vue\"\nexport default component.exports","export * from \"-!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home_setting.vue?vue&type=template&id=21de40b3&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home_setting.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX-alpha/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./home_setting.vue?vue&type=script&lang=js&\"","<template>\n\n  <view class=\"container\">\n    <view class=\"setting-container\">\n      <i-cell-group>\n        <view :style=\"'text-align: center;font-size: 28rpx;padding: 30rpx 0;color: #f40;;display:' + (isVersion == 1?'none':'block')\">当前微信版本低，无法接收消息通知，建议升级微信</view>\n        <i-panel title=\"页面样式设置\">\n          <i-cell title=\"首页图标悬浮\" label=\"仅影响本地显示\">\n            <i-switch :value=\"entry.iconTop\" @change=\"setIconTop\" slot=\"footer\">\n            </i-switch>\n          </i-cell>\n          <i-cell :style=\"'display:' + (userRole > 2?'none':'block')\" title=\"更换组织封面\" is-link url=\"/pages/settings/header\"></i-cell>\n        </i-panel>\n        <i-panel title=\"系统发送通知设置\" :style=\"'display:' + (userRole > 2?'none':'block')\">\n          <i-cell title=\"发送微信通知\" label=\"作用于当前组织\">\n            <i-switch :value=\"entry.wxNotify\" @change=\"setNotify('wxNotify')\" slot=\"footer\">\n            </i-switch>\n          </i-cell>\n          <i-cell title=\"发送APP通知\" label=\"作用于当前组织，未安装APP无法收到通知\">\n            <i-switch :value=\"entry.appNotify\" @change=\"setNotify('appNotify')\" slot=\"footer\">\n            </i-switch>\n          </i-cell>\n        </i-panel>\n        <i-panel title=\"车辆审批设置\" :style=\"'display:' + (userRole > 2?'none':'block')\">\n          <i-cell title=\"系统管理员可直接审批\" label=\"设置是否可越过部门管理员直接审批\">\n            <i-switch :value=\"entry.systemAudit\" @change=\"setNotify('systemAudit')\" slot=\"footer\">\n            </i-switch>\n          </i-cell>\n        </i-panel>\n        <i-panel title=\"接收通知设置（为零，则无法收到相关通知）\">\n          <i-cell title=\"约车通知\" label=\"新申请通知、审批结果通知等\">\n            <i-button @tap=\"subscribMsg('wx_tmpl_id_car_audit')\" inline slot=\"footer\" size=\"small\">（{{tmplIds.wx_tmpl_id_car_audit.count}}）增加</i-button>\n          </i-cell>\n          <i-cell title=\"预约会议室通知\" label=\"新申请通知、审批结果通知等\">\n            <i-button @click=\"subscribMsg('wx_tmpl_id_audit')\" inline slot=\"footer\" size=\"small\">（{{tmplIds.wx_tmpl_id_audit.count}}）增加</i-button>\n          </i-cell>\n          <i-cell title=\"公告通知\" label=\"及时收到公告提醒\">\n            <i-button @click=\"subscribMsg('wx_tmpl_id_unread')\" inline slot=\"footer\" size=\"small\">（{{tmplIds.wx_tmpl_id_unread.count}}）增加</i-button>\n          </i-cell>\n          <i-cell title=\"留言通知\" label=\"及时收到用户的留言提醒\" :style=\"'display:' + (companyId == 2?'block':'none')\">\n            <i-button @click=\"subscribMsg('wx_tmpl_id_suggest')\" inline slot=\"footer\" size=\"small\">（{{tmplIds.wx_tmpl_id_suggest.count}}）增加</i-button>\n          </i-cell>\n          <i-cell title=\"留言回复通知\" label=\"及时收到您反馈、留言的回复提醒\">\n            <i-button @click=\"subscribMsg('wx_tmpl_id_suggest_reply')\" inline slot=\"footer\" size=\"small\">（{{tmplIds.wx_tmpl_id_suggest_reply.count}}）增加</i-button>\n          </i-cell>\n        </i-panel>\n      </i-cell-group>\n    </view>\n  </view>\n\n</template>\n\n<script>\nimport wxRequest from '@/utils/wxRequest';\nimport tip from '@/utils/tip';\nimport Session from '@/utils/session';\nimport util from '@/utils/util.js';\n\nexport default {\n  data() {\n    return {\n\n        user: {\n          name: '访客'\n        },\n        entry: {\n          iconTop: false,\n          wxNotify: true,\n          appNotify: true,\n          smsNotify: false,\n          systemAudit: false\n        },\n        userRole: 6,\n        companyId: 0,\n        tmplIds: {},\n        isVersion: 0\n\n    };\n  },\n\n  onLoad() {\n    this.getUser();\n    this.entry.iconTop = Session.get('iconTop') == null ? true : Session.get('iconTop') == 1 ? true : false;\n    this.entry.wxNotify = this.getOrgSetting(\"wxNotify\");\n    this.entry.appNotify = this.getOrgSetting(\"appNotify\");\n    this.entry.systemAudit = this.getOrgSetting(\"systemAudit\");\n    this.userRole = Session.get(\"userRole\");\n    let user = Session.get('user_load_cache');\n    this.companyId = user.companyId;\n    let version = Session.get('wxVersion') || null;\n\n    if (version != null) {\n      this.isVersion = util.cpVersion(version, '7.0.6');\n    }\n  },\n\n  onShow() {},\n\n  mixins: [],\n  components: {},\n  props: {},\n  methods: {\n    redirect(url) {\n      uni.navigateTo({\n        url: url\n      });\n    },\n\n    setIconTop(event) {\n      this.entry.iconTop = event.detail.value;\n      Session.set('iconTop', event.detail.value ? 1 : 2);\n    },\n\n    setNotify(type, event) {\n      this.entry[type] = event.detail.value;\n      this.saveOrgSetting(type, event.detail.value);\n    },\n\n    developing() {\n      wx.showToast({\n        title: '开发中，敬请期待',\n        icon: 'none'\n      });\n    },\n\n    async subscribMsg(key) {\n      if (this.isTest) {\n        return;\n      }\n\n      let kv = key || null;\n\n      if (kv == null) {\n        await tip.confirm('无法增加！可能您之前已选择拒绝收通知，请点击小程序上边三个点的按钮-->选择设置-->消息订阅-->打开接收订阅消息', {}, '操作提示', false);\n        return;\n      }\n\n      let auditAlerted = Session.get(\"auditAlerted\");\n\n      if (auditAlerted !== \"true\") {\n        await tip.confirm('尊敬的客户，稍后的消息订阅框，请您务必点击允许，并选择【总是保持以上选择】，以使本软件更好为您服务，谢谢！', {}, '新用户重要提示', false);\n        Session.set(\"auditAlerted\", \"true\");\n      }\n\n      tip.loading(\"处理中...\");\n      let subscribIds = [];\n      let subscribKeys = {};\n      subscribIds.push(this.tmplIds[key].id);\n      subscribKeys[this.tmplIds[key].id] = key;\n      new Promise((resolve, reject) => {\n        wx.requestSubscribeMessage({\n          tmplIds: subscribIds,\n          success: res => {\n            let acceptKeys = [];\n            subscribIds.forEach(tmplId => {\n              if (res[tmplId] === 'accept') {\n                acceptKeys.push(subscribKeys[tmplId]);\n              }\n            });\n            resolve(acceptKeys);\n          },\n\n          fail(err) {\n            //失败\n            tip.loaded();\n            tip.confirm('增加通知数量失败！失败原因：' + err.errMsg, {}, '提示', false);\n            console.error(err);\n            reject();\n          }\n\n        });\n      }).then(res => {\n        this.updateTmplIds(res);\n      });\n    },\n\n    async getUserSetting(key) {\n      const data = await wxRequest.Get('setting/getUserSetting', {\n        key: key\n      });\n\n      if (data.code >= 1 && data.result != \"\") {\n        this.entry[key] = data.result;\n\n        if (data.result == \"true\" || data.result == \"false\") {\n          this.entry[key] = data.result == \"true\" ? true : false;\n        }\n      }\n    },\n\n    async getOrgSetting(key) {\n      const data = await wxRequest.Get('setting/getOrgSetting', {\n        key: key\n      });\n\n      if (data.code >= 1 && data.result != \"\") {\n        this.entry[key] = data.result;\n\n        if (data.result == \"true\" || data.result == \"false\") {\n          this.entry[key] = data.result == \"true\" ? true : false;\n        } else {\n          if (key == \"systemAudit\") {\n            this.entry[key] = false;\n          } else {\n            this.entry[key] = data.result;\n          }\n        }\n      } else {\n        if (key == \"systemAudit\") {\n          this.entry[key] = false;\n        }\n      }\n    },\n\n    async saveUserSetting(key, value) {\n      const data = await wxRequest.Get('setting/saveUserSetting', {\n        key: key,\n        value: value\n      });\n    },\n\n    async saveOrgSetting(key, value) {\n      const data = await wxRequest.Get('setting/saveOrgSetting', {\n        key: key,\n        value: value\n      });\n    },\n\n    async getUser() {\n      let data = await wxRequest.Get('settings');\n\n      if (data != undefined && data.code >= 1) {\n        this.tmplIds = data.result.user.tmplIds;\n      } else {\n        tip.error(data.message);\n      }\n    },\n\n    async updateTmplIds(acceptKeys) {\n      let tmpKeyStr = '';\n      acceptKeys.forEach(key => {\n        tmpKeyStr = tmpKeyStr + key + \",\";\n      });\n      const data = await wxRequest.Get('updateTmplIds', {\n        tmplIds: tmpKeyStr\n      });\n\n      if (data.code >= 1) {\n        //页面增加，不再从服务器装载，减少调用\n        acceptKeys.forEach(key => {\n          this.tmplIds[key].count = this.tmplIds[key].count + 1;\n        });\n      } else {\n        if (data.message != '') {\n          tip.error(data.message);\n        }\n      }\n\n      tip.loaded();\n    }\n\n  },\n  computed: {},\n  watch: {}\n};\n</script>\n<style lang=\"scss\" src=\"@/static/styles/setting.scss\">\n\n\n\n</style>"],"sourceRoot":""}